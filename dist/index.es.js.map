{"version":3,"file":"index.es.js","sources":["../src/AsyncQueue.ts","../src/index.ts"],"sourcesContent":["import { EventEmitter } from \"events\"\n\ninterface AsyncQueueProps {\n    maxConcurrency?: number\n}\n\ntype QueueableFunction = (params: any) => void\n\nclass AsyncQueue {\n    private readonly maxConcurrency: number\n    private concurrency: number = 0\n    private queue: Array<QueueableFunction> = []\n    private eventEmitter: EventEmitter\n\n    constructor(props: AsyncQueueProps) {\n        this.maxConcurrency = props.maxConcurrency || 1\n        this.eventEmitter = new EventEmitter()\n    }\n\n    public push(func: QueueableFunction) {\n        this.queue.push(func)\n\n        this.flushIfRequired()\n    }\n\n    private flushIfRequired() {\n        if (this.concurrency < this.maxConcurrency) {\n            this.flush()\n        }\n    }\n\n    private flush() {\n        const func = this.queue.shift()\n\n        if (func) {\n            this.concurrency++\n            this.eventEmitter.emit(\"entry\")\n            func.call(null, this.done)\n        }\n    }\n\n    private done(error: any) {\n        this.concurrency--\n        this.eventEmitter.emit(\"exit\")\n        if (error) {\n            this.eventEmitter.emit(\"error\", error)\n        }\n\n        if (!this.queue.length && !this.concurrency) {\n            this.eventEmitter.emit(\"drain\")\n        }\n\n        this.flushIfRequired()\n    }\n}\n\nexport default AsyncQueue\n","import AsyncQueue from \"./AsyncQueue\"\n\nexport default (maxConcurrency: number = 1): AsyncQueue => new AsyncQueue({\n    maxConcurrency,\n})\n"],"names":[],"mappings":";;AAQA;IAMI,oBAAY,KAAsB;QAJ1B,gBAAW,GAAW,CAAC,CAAA;QACvB,UAAK,GAA6B,EAAE,CAAA;QAIxC,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC,cAAc,IAAI,CAAC,CAAA;QAC/C,IAAI,CAAC,YAAY,GAAG,IAAI,YAAY,EAAE,CAAA;KACzC;IAEM,yBAAI,GAAX,UAAY,IAAuB;QAC/B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAErB,IAAI,CAAC,eAAe,EAAE,CAAA;KACzB;IAEO,oCAAe,GAAvB;QACI,IAAI,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE;YACxC,IAAI,CAAC,KAAK,EAAE,CAAA;SACf;KACJ;IAEO,0BAAK,GAAb;QACI,IAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAA;QAE/B,IAAI,IAAI,EAAE;YACN,IAAI,CAAC,WAAW,EAAE,CAAA;YAClB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;YAC/B,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAA;SAC7B;KACJ;IAEO,yBAAI,GAAZ,UAAa,KAAU;QACnB,IAAI,CAAC,WAAW,EAAE,CAAA;QAClB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QAC9B,IAAI,KAAK,EAAE;YACP,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;SACzC;QAED,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACzC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;SAClC;QAED,IAAI,CAAC,eAAe,EAAE,CAAA;KACzB;IACL,iBAAC;CAAA,IAAA;;ACpDD,aAAe,UAAC,cAA0B;IAA1B,+BAAA,EAAA,kBAA0B;IAAiB,OAAA,IAAI,UAAU,CAAC;QACtE,cAAc,gBAAA;KACjB,CAAC;CAAA,EAAA;;;;"}